function spikes = getSpikesFromRates(r,type,FS)% Function to generate spikes given the instantaneous rate 'r' and% fibertype 'type'%% USAGE:%   spiketimes = getSpikesFromRates(r,type);%% type: 1 for LS, anything else for HS%code from Hari Bharadwaj based on the paper of Jackson and Carney (2005) JARO. %comments and discussions provided by Sarah VerhulstH = 0.9;        % Hurst index for fractional-Gaussian-noise (fGn) in the long-range-dependent%   processes (0.5 < H < 1).tau = 1/FS;     % "Hold" time for each discrete point in the fGn.if(type == 1)                        % Means of fGns for low and high rate simulations.    sigma=1;           %this is the sigma (std) of the fGn that makes that the spikerate before                          %and after the LRDpoissonprocess are the same (found emperically) else    sigmaF= 60;           %this value works well for HS (same as in Jackson)    fGnUnitVar = 9;             % Only used in follwing line.  See paper for details.    sigma = sqrt(sigmaF*fGnUnitVar);% Standard deviations of fGns (see Jackson and Carney 2005)                            %take a constant lambda here (that equals the HS factor)        end%amount = [.39 .61];        % Fractions of low and high rate simulations.if type==1    sigma=1;endlen = numel(r);noiseLRD = ffGn(len, H, sigma, 0);   % Get a sample of LRD fGn. %sigma determines the std.dev %spikerate deterimines the mu (mean) of the sample%keyboard%is what creates the refractoriness, see that in plotting the%autocorrelation and the negative parts (in those negative parts from the peak, spiking is not possible)%figure,plot(xcov(noiseLRD,noiseLRD)) %the refractoriperiod can be changed by changing the Hurst index (is what determines the long range dependence)%very short in time, the signals look quite alike, very far in time, they%are not alike (i.e., is LRD)spikes = poissonproc(noiseLRD  + r' , tau,'transform'); % Simulate the Poisson-like integrate-and-fire process.%the poissonprocesses is what creates a distribution of spikes around the%mean spiking rate. Because we add the ffGn to it, the distribution will look like a psth.%tau is just the sampling period. And this is an%integrate and fire process to generate spikes. 